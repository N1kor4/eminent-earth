---
// LangSwitcher.astro
const url = new URL(Astro.request.url);
const path = url.pathname.replace(/^\/(fr|en)/, '') || '/';

const languages = [
  { code: 'fr', label: 'ğŸ‡«ğŸ‡· FranÃ§ais' },
  { code: 'en', label: 'ğŸ‡¬ğŸ‡§ English' },
];
---
<div class="lang-dropdown" data-lang-switcher>
  <button
    class="lang-switcher"
    type="button"
    aria-haspopup="true"
    aria-expanded="false"
  >
    ğŸŒ
  </button>
  <ul class="lang-menu hidden" aria-hidden="true">
    {languages.map(lang => (
      <li>
        <a href={`/${lang.code}${path}`}>{lang.label}</a>
      </li>
    ))}
  </ul>
</div>

<style>
.lang-dropdown {
  position: relative;
}

.lang-switcher {
  background: none;
  border: none;
  cursor: pointer;
  font-size: 1.25rem;
  padding: 0.25rem;
  display: inline-flex;
  align-items: center;
  justify-content: center;
}

.lang-menu {
  position: absolute;
  top: calc(100% + 0.4rem);
  right: 0;
  background: var(--color-surface, #2b2b2b);
  border-radius: 0.5rem;
  box-shadow: 0 6px 20px rgba(0, 0, 0, 0.12);
  padding: 0.25rem 0;
  min-width: 10rem;
  z-index: 60;
  display: flex;
  flex-direction: column;
  gap: 0;
  line-height: 1;
}

.lang-menu.hidden {
  display: none;
}

.lang-menu li {
  list-style: none;
}

.lang-menu a {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.5rem 0.9rem;
  color: inherit;
  border-radius: 0.35rem;
  font-size: inherit;
  text-decoration: none !important;
}

.lang-menu a:focus {
  background: rgba(0, 0, 0, 0.06);
}
</style>

<script is:inline>
(() => {
  const root = document.querySelector('[data-lang-switcher]');
  if (!root) return;

  const switcher = root.querySelector('.lang-switcher');
  const menu = root.querySelector('.lang-menu');

  // Toggle menu visibility
  switcher.addEventListener('click', (e) => {
    e.preventDefault();
    const isHidden = menu.classList.toggle('hidden');
    menu.setAttribute('aria-hidden', isHidden ? 'true' : 'false');
    switcher.setAttribute('aria-expanded', isHidden ? 'false' : 'true');
  });

  // Close on outside click
  document.addEventListener('click', (e) => {
    if (!root.contains(e.target)) {
      menu.classList.add('hidden');
      menu.setAttribute('aria-hidden', 'true');
      switcher.setAttribute('aria-expanded', 'false');
    }
  });

  // Close on Escape
  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') {
      menu.classList.add('hidden');
      menu.setAttribute('aria-hidden', 'true');
      switcher.setAttribute('aria-expanded', 'false');
      switcher.focus();
    }
  });
})();
</script>
