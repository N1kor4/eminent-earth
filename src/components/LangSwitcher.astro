---
// LangSwitcher.astro
---
<div class="lang-dropdown" data-lang-switcher>
  <button class="lang-switcher" type="button" aria-haspopup="true" aria-expanded="false">üåê</button>
  <ul class="lang-menu hidden" aria-hidden="true"></ul>
</div>

<style>
/* wrapper */
.lang-dropdown { position: relative; }

/* button */
.lang-switcher {
  background: none;
  border: none;
  cursor: pointer;
  font-size: 1.25rem;
  line-height: 1;
  padding: .25rem;
  display: inline-flex;
  align-items: center;
  justify-content: center;
}

/* menu (vertical stack) */
.lang-menu {
  position: absolute;
  top: calc(100% + 0.4rem);
  right: 0;
  background: var(--card-bg, #887f7f);
  border-radius: .5rem;
  box-shadow: 0 6px 20px rgba(0,0,0,.12);
  padding: .25rem 0;
  margin: 0;
  min-width: 10rem;
  z-index: 60;

  display: flex;
  flex-direction: column;    /* vertical */
  gap: 0;
}

/* hidden state */
.lang-menu.hidden { display: none; }

/* list item reset */
.lang-menu li { list-style: none; margin: 0; padding: 0; }

/* anchor - vertical, no underline (high specificity) */
.lang-menu a,
.lang-menu a:link,
.lang-menu a:visited,
.lang-menu a:hover,
.lang-menu a:focus {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  padding: .5rem .9rem;
  text-decoration: none !important; /* override global underline if necessary */
  color: inherit;
  border-radius: .35rem;
  font-size: .95rem;
  outline: none;
}

/* hover / focus */
.lang-menu a:hover {
  text-decoration: underline;
},
.lang-menu a:focus {
  background: rgba(0,0,0,0.06);
}
</style>

<script is:inline>
(() => {
  const root = document.querySelector('[data-lang-switcher]');
  if (!root) return;

  const switcher = root.querySelector('.lang-switcher');
  const menu = root.querySelector('.lang-menu');

  const currentPath = window.location.pathname;
  // remove leading /fr or /en; ensure at least '/' remains
  let cleanPath = currentPath.replace(/^\/(fr|en)/, '');
  if (!cleanPath) cleanPath = '/';

  // Build links preserving the rest of the path
  menu.innerHTML = `
    <li><a href="/fr${cleanPath}">üá´üá∑ Fran√ßais</a></li>
    <li><a href="/en${cleanPath}">üá¨üáß English</a></li>
  `;

  // Toggle menu visibility
  switcher.addEventListener('click', (e) => {
    e.preventDefault();
    const isHiddenAfterToggle = menu.classList.toggle('hidden'); // true = hidden
    menu.setAttribute('aria-hidden', isHiddenAfterToggle ? 'true' : 'false');
    switcher.setAttribute('aria-expanded', isHiddenAfterToggle ? 'false' : 'true');
  });

  // Close on click outside
  document.addEventListener('click', (e) => {
    if (!root.contains(e.target)) {
      menu.classList.add('hidden');
      menu.setAttribute('aria-hidden', 'true');
      switcher.setAttribute('aria-expanded', 'false');
    }
  });

  // Close on Escape
  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') {
      menu.classList.add('hidden');
      menu.setAttribute('aria-hidden', 'true');
      switcher.setAttribute('aria-expanded', 'false');
      switcher.focus();
    }
  });
})();
</script>
